def correct_line_breaks(text):
    lines = text.split('\n')
    combined_line = ""
    corrected_lines = []

    # 定义关键字和文件扩展名
    key_fragments = re.compile(r'(https?|ftp|file)://|\.com|\.org|\.net|\.html|\.pdf|\.xls|\.xlsx|\.mp3|%[0-9A-Fa-f]{2}')

    for line in lines:
        stripped_line = line.strip()

        if combined_line:
            # 检查当前行是否是前一行的延续
            if key_fragments.search(stripped_line) or (combined_line and combined_line[-1].isalnum() and stripped_line and stripped_line[0].isalnum()):
                combined_line += stripped_line
            else:
                corrected_lines.append(combined_line)
                combined_line = stripped_line
        else:
            combined_line = stripped_line

    if combined_line:
        corrected_lines.append(combined_line)

    # 确保在需要的地方添加换行符
    formatted_text = '\n'.join(corrected_lines)
    formatted_text = formatted_text.replace('. ', '.\n')
    formatted_text = formatted_text.replace('):', '):\n')
    formatted_text = formatted_text.replace(')\n', ')\n\n')
    formatted_text = re.sub(r'(\d\.\s)', r'\n\1', formatted_text)

    return formatted_text
