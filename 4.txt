import cv2
from PIL import Image
import pytesseract
from pytesseract import Output

# 需要指定 tesseract 的安装路径，如果你的 tesseract 在 Linux 系统的标准路径下，可以注释掉这行代码
# pytesseract.pytesseract.tesseract_cmd = '/usr/bin/tesseract'

def detect_text_and_draw_boxes(image_path, output_path):
    # 加载图像
    image = cv2.imread(image_path)
    # 将图像转换为 RGB，因为 pytesseract 需要 RGB 图像
    rgb_image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)

    # 使用 pytesseract 进行字符检测，获取每个字符的详细信息
    details = pytesseract.image_to_data(rgb_image, output_type=Output.DICT)

    # 在图像上绘制每个检测到的字符的边框
    n_boxes = len(details['text'])
    for i in range(n_boxes):
        if int(details['conf'][i]) > 60:  # 置信度阈值
            (x, y, w, h) = (details['left'][i], details['top'][i], details['width'][i], details['height'][i])
            cv2.rectangle(image, (x, y), (x + w, y + h), (0, 255, 0), 2)

    # 保存结果图像
    cv2.imwrite(output_path, image)

# 调用函数
image_path = 'path_to_your_image.jpg'  # 将这里替换为你的图像路径
output_path = 'output_image.jpg'  # 输出图像的保存路径
detect_text_and_draw_boxes(image_path, output_path)
