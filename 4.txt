import cv2
import pytesseract
from PIL import Image

# 配置 Tesseract 的路径，如果需要
pytesseract.pytesseract.tesseract_cmd = r'YOUR_TESSERACT_PATH'  # 例如，r'C:\Program Files\Tesseract-OCR\tesseract.exe'

# 加载图像
image_path = 'input_image.png'
image = cv2.imread(image_path)

# 将图像转换为 RGB 格式（Pillow 使用 RGB 格式）
rgb_image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)

# 使用 Tesseract 获取 OCR 数据
custom_config = r'--oem 1 --psm 3'  # 使用 LSTM 引擎，自动检测方向并分析整个页面
data = pytesseract.image_to_data(rgb_image, config=custom_config, output_type=pytesseract.Output.DICT)

# 遍历所有检测到的单词，并绘制边界框
n_boxes = len(data['text'])
for i in range(n_boxes):
    if int(data['conf'][i]) > 0:  # 过滤掉置信度为负的检测
        (x, y, w, h) = (data['left'][i], data['top'][i], data['width'][i], data['height'][i])
        cv2.rectangle(image, (x, y), (x + w, y + h), (0, 255, 0), 2)

# 显示结果图像
cv2.imshow('Image with Bounding Boxes', image)
cv2.waitKey(0)
cv2.destroyAllWindows()

# 保存结果图像
cv2.imwrite('output_image_with_boxes.png', image)

